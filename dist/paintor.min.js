var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{eK:()=>v,ZP:()=>C,Iv:()=>y});class n{elements=[];addElement(t){this.elements.push(t)}getElements(){return this.elements}importElements(t){const e=t.getElements();for(const t of e)this.addElement(t)}removeAllElements(){this.elements=[]}removeTheseElements(t){if(t.length>0){const e=[];for(const n of this.elements)-1===t.indexOf(n)&&e.push(n);this.elements=e}}}const r=["async","autofocus","autoplay","checked","contenteditable","controls","default","defer","disabled","formNoValidate","frameborder","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","readonly","required","reversed","scoped","selected","typemustmatch"],s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","command","keygen","menuitem"];function o(t){let e="";return e=t.replace(/([A-Z])/g,((t,e)=>`-${e.toLowerCase()}`)),e}class i{nextSibling=null;previousSibling=null;#attributes=[];#children=[];#parentElement=null;#tagName="";#textContent="";#nodeType=1;#removed=!1;#style={};constructor(t,e,n=!1){this.#parentElement=t,this.#tagName=e.toLowerCase(),this.#nodeType=n?8:1}get className(){let t="";for(const e of this.#attributes)if("class"===e.name){t=e.value;break}return t}set className(t){this.setAttribute("class",t)}get innerHTML(){return this.#textContent}set innerHTML(t){this.#textContent=t}get innerText(){return this.textContent}set innerText(t){this.textContent=t}get nodeName(){return this.#tagName.toUpperCase()}get nodeType(){return this.#nodeType}get parentElement(){return this.#parentElement}set parentElement(t){this.#parentElement=t}get tagName(){return this.#tagName.toUpperCase()}get textContent(){return this.#textContent}set textContent(t){this.#textContent=function(t){let e=t;const n={"&":"&amp;","<":"&lt;",">":"&gt;"};return e=e.replace(/[&<>"]/g,(t=>{let e=t;return t in n&&(e=n[t]),e})),e}(t.toString())}get style(){return this.#style}set style(t){if("string"==typeof t){const e=function(t){const e={};return t.split(";").forEach((t=>{const[n,r]=t.split(":");if(!n)return;const s=function(t){const e=t.split("-");return 1===e.length?e[0]:e[0]+e.slice(1).map((t=>t[0].toUpperCase()+t.slice(1))).join("")}(n.trim());e[s]=r.trim()})),e}(t);for(const t in e)this.#style[t]=e[t].toString()}return this.#style}append(t){t instanceof i?this.appendChild(t):this.textContent=t}appendChild(t){const e=t;if(8===this.nodeType)throw new Error("This node type does not support this method.");if(!(e instanceof i))throw new Error("Failed to execute 'appendChild' on 'Element': parameter 1 is not of type 'Element'.");e.parentElement=this,this.#children.push(e);const n=this.#children.length-2;n>=0&&(this.#children[n].nextSibling=e,e.previousSibling=this.#children[n])}paint(t=0,e=!1){if(this.#removed)return"";let n="",i="",l="";if(t>-1&&(i=function(t){let e="";for(let n=0;n<t;n++)e+="\t";return e}(t),l="\n"),8===this.nodeType)n+=`${l}${i}\x3c!--${this.textContent}--\x3e`;else{const a=s.includes(this.#tagName),c=function(t){let e="";for(const n of t){const{name:t}=n;let{value:s}=n;r.includes(t)?!1!==s&&0!==s&&null!=s&&(e+=` ${t}`):(s=s instanceof Array?s.join(","):!0===s?"true":!1===s?"false":void 0===s?"undefined":null===s?"null":s.toString(),e+=` ${t}="${s}"`)}return e}(this.#attributes);let u="";Object.keys(this.style).length>0&&(u=` style="${function(t){let e="";for(const n in t){const r=t[n];e+=`${o(n)}:${r};`}return e.trim()}(this.style)}"`),e&&(n+=l),n+=`${i}<${this.#tagName}${c}${u}`,n+=a?"":">",n+=this.#textContent;let m="";for(const e of this.#children)m+=e.paint(-1===t?-1:t+1,!0);m&&(n+=m+l+i),n+=a?"/>":`</${this.#tagName}>`}return n}paintChildren(){let t="",e=0;for(const n of this.#children){e+=1;const r=e>1;t+=n.paint(0,r)}return t}remove(){this.#removed=!0}setAttribute(t,e){let n="";if(n=t.trim().toLowerCase(),!n)return;const r=e,s=this.#attributes.findIndex((t=>t.name===n));-1===s?this.#attributes.push({name:n,value:r}):this.#attributes[s]={name:n,value:r}}}class l{#container;constructor(){this.#container=new i(null,"body")}get body(){return this.#container}get parentElement(){return null}createComment(t=""){const e=new i(null,"",!0);return e.textContent=t,e}createElement(t){return new i(null,t,!1)}paint(t=!0){const e=t?0:-1;return this.body.paint(e)}}function a(t,e){for(const n of t)e.push(n);return e}function c(t){return 0===t.toLowerCase().indexOf("on")}function u(t,e,n){return t instanceof Node&&"string"==typeof e&&"function"==typeof n&&!1!==c(e)&&(t.addEventListener(e.toLowerCase().substr(2),n),!0)}function m(t,e){t instanceof i?function(t,e){for(const n of e)n&&t.appendChild(n)}(t,e):function(t,e){if(1===e.length)t.appendChild(e[0]);else if(e.length>1){const n=new DocumentFragment;for(const t of e)t&&n.append(t);t.appendChild(n)}}(t,e)}function h(t,e,n){e in t?t[e]=n:t.setAttribute(e,n)}function f(t,e){let n=e;return"visibility"!==t&&"backfaceVisibility"!==t||!0!==e&&!1!==e&&null!=e||(n=e?"visible":"hidden"),"display"!==t||!0!==e&&!1!==e&&null!=e||(n=e?"":"none"),"flex"!==t||!0!==e&&!1!==e&&null!=e||(n=e?1:0),n}const p=["a","abbr","address","applet","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];class d{#collectedElements=[new n];#paintorWrapper;#global;constructor(t){this.#paintorWrapper=t,this.#global=this.#paintorWrapper.global}createElement(t,...e){const n=this.#global.createElement(t),r=this.#global instanceof l;let s=[],o=0;for(const t of e)if(o+=1,"string"==typeof t||"number"==typeof t)n.textContent=t;else if(t instanceof Function){const e="propertyName",r=t;this.#subscribeToBindings({element:n,propertyName:e,bindFunction:r}),n[e]=r(n)}else r&&t instanceof i||!r&&t instanceof Node?s.push(t):t instanceof Array?s=a(t,s):t instanceof Error?n.textContent=t:t instanceof Object&&1===o&&this.#setPropertiesToElement(n,t);if(m(n,s),s.length>=0){const t=this.#collectedElements.length-1;this.#collectedElements[t].removeTheseElements(s),this.#collectedElements[t].addElement(n)}return n}finalPaint(){let t="";const e=this.#collectedElements[0].getElements(),r=this.#paintorWrapper.containerElement;return m(r,e),this.#global instanceof l&&(t=r.paintChildren()),this.#collectedElements=[new n],t}forLoop(...t){if(t.length<2||t.length>3)return new Error(`Wrong number of arguments. Expected 2 or 3, got ${t.length}`);let e,n,r=0,s=0,o=0;2===t.length?([e,n]=t,"number"!=typeof t[0]?o=1:(o=2,t[0]>=0?(r=0,s=t[0]-1):(r=-t[0]-1,s=0))):3===t.length&&([r,s,n]=t,o=3);const i=this.#beforeStatement();let l=null;1===o?l=function(t,e){if(!(t instanceof Object||t instanceof Array))return new Error('"data" argument should be an Object or an Array');if(!(e instanceof Function))return new Error('"handler" argument should be a Function');for(const n in t)if(!1===e(n,t[n]))break;return!0}(e,n):2!==o&&3!==o||(l=function(t,e,n){if("number"!=typeof t||"number"!=typeof e)return new Error('"start" and "end" arguments should be numbers');if(!(n instanceof Function))return new Error('"handler" argument should be a Function');if(e>=t)for(let r=t;r<=e&&!1!==n(r);r++);else for(let r=t;r>=e&&!1!==n(r);r--);return!0}(r,s,n));const a=this.#afterStatement(i);return l instanceof Error?l:a}if(t,e){const{thisLevel:n,upperLevel:r}=this.#beforeStatement();if("function"==typeof t){const r=t,s=this.#global.createComment("IF BEGIN");this.#collectedElements[n].addElement(s);const o=t=>{this.#collectedElements[0].removeAllElements(),this.#removeStatementElements(s),t&&e(),this.#insertStatementElements(s,this.#collectedElements[0].getElements())||console.error("Element ",s," does not exist anymore")};this.#subscribeToBindings({element:s,propertyName:"--if",bindFunction:r,statementCallback:o})}if((t instanceof Function?t():t)&&"function"==typeof e&&e(),"function"==typeof t){const t=this.#global.createComment("IF END");this.#collectedElements[n].addElement(t)}return this.#afterStatement({thisLevel:n,upperLevel:r})}#insertStatementElements(t,e){let n=t;if(!1===this.#global.body.contains(n))return!1;for(const t of e)r=t,(s=n).parentNode.insertBefore(r,s.nextSibling),n=t;var r,s;return!0}#removeStatementElements(t){if(8!==t.nodeType)return-1;const e=t.textContent;let n="";if("IF BEGIN"===e)n="IF END";else{if("FOR BEGIN"!==e)return-1;n="FOR END"}let r=t.nextSibling,s=0,o=0;for(;null!==r;){let t=!1;if(8===r.nodeType){const o=r.textContent;if(o===e)s+=1,t=!0;else if(o===n&&(s-=1,s<0))break}const{nextSibling:i}=r;t&&(r["--deleted"]=!0),r.remove(),o+=1,r=i}return o}#beforeStatement(){const t=this.#collectedElements.length,e=t-1;return this.#collectedElements.push(new n),{thisLevel:t,upperLevel:e}}#afterStatement({thisLevel:t,upperLevel:e}){const n=this.#collectedElements[t].getElements();return this.#collectedElements[e].importElements(this.#collectedElements[t]),this.#collectedElements[t].removeAllElements(),delete this.#collectedElements[t],this.#collectedElements.pop(),n}#setPropertiesToElement(t,e){for(const n in e){let r=e[n];if(this.#global instanceof l)c(n)&&r instanceof Function&&(r=r.toString());else if(u(t,n,r))continue;if(r instanceof Function){const e=r;this.#subscribeToBindings({element:t,propertyName:n,bindFunction:e}),h(t,n,e(t))}else if("style"===n&&r instanceof Object){const e=r;for(const r in e){const s=e[r];let o="";if(s instanceof Function){const e=s;this.#subscribeToBindings({element:t,propertyName:n,subPropertyName:r,bindFunction:e}),o=e(t)}else o=s;t.style[r]=f(r,o)}}else h(t,n,r)}}#subscribeToBindings({element:t,propertyName:e,subPropertyName:n="",bindFunction:r,statementCallback:s}){const o=function(t){const e=t.toString(),n=/(?:[^\w_$.]|^)([a-zA-Z_$][\w_$]*)\.([\w_$.]+)/g,r={};let s;for(;null!==(s=n.exec(e));){const e=s[1],n=s[2];e in r||(r[e]={}),n in r[e]||(r[e][n]=[]),r[e][n].includes(t)||r[e][n].push(t)}return r}(r);for(const i in o)if(i in this.#paintorWrapper.states)for(const l in o[i]){const o=l.split(".");let a=this.#paintorWrapper.states[i];for(let t=0;t<o.length-1;t++)a=a[o[t]];this.#paintorWrapper.states[i]["--subscribe"].subscribe(l,t,e,n,r,s)}}}Function.prototype.bindArgs=function(...t){const e=this;return function(...n){return e.call(this,...t,...n)}};for(const t of p)d.prototype[t]=d.prototype.createElement.bindArgs(t);d.prototype.for=d.prototype.forLoop;class b{#containerElement=null;#states={};#global;#finalHtmlCode="";constructor({target:t,states:e,contents:n,theGlobal:r}){this.#global=r;const s=new d(this);this.#initConstructorArguments(t,e,n)instanceof Error||(this.#clearContainerElement(),n(s,e),this.#finalHtmlCode=s.finalPaint())}get containerElement(){return this.#containerElement}get global(){return this.#global}get states(){return this.#states}getHtmlCode(){return this.#finalHtmlCode}#initConstructorArguments(t,e,n){let r;return r=this.#validateTarget(t),r instanceof Error?r:(r=this.#validateStates(e),r instanceof Error?r:(r=this.#validateTreeFunction(n),!(r instanceof Error)||r))}#validateTarget(t){const e=this.#global instanceof l;if(e&&t instanceof i||!e&&t instanceof Node)this.#containerElement=t;else{if("string"!=typeof t)return new Error(`Wrong type for the container element. Expected <string> or <Node>, got <${typeof t}>`);if(this.#containerElement=this.#global instanceof l?this.#global.createElement("#container"):document.getElementById(t),!this.#containerElement)return new Error(`Could not locate element #${t}`)}return!0}#validateStates(t){if(!(t instanceof Object))return new Error("states must be an Object");for(const e in t){const n=t[e];"--state-path"in n?this.states[e]=n:this.#global instanceof l||console.error(`The input "${e}" is "${typeof n}", but it should be a state`)}return!0}#validateTreeFunction(t){return"function"==typeof t||new Error("treeFunction must be a function")}#clearContainerElement(){const t=this.#containerElement;for(;t.firstChild;)t.removeChild(t.firstChild)}}class g{subscriptions={};proxy;constructor(t){this.proxy=this.#createProxy(t)}getState(){return this.proxy}subscribe(t,e,n,r,s,o){this.subscriptions[t]=this.subscriptions[t]||[];for(const i of this.subscriptions[t])if(i.element===e&&i.propertyName===n&&i.subPropertyName===r&&i.bindFunction===s&&i.statementCallback===o)return;this.subscriptions[t].push({element:e,propertyName:n,subPropertyName:r,bindFunction:s,statementCallback:o})}unsubscribe(t){for(const e in this.subscriptions){const n=this.subscriptions[e];let r=!1;for(let e=0;e<n.length;e++)n[e].element===t&&(delete n[e],r=!0);r&&(this.subscriptions[e]=this.subscriptions[e].filter(Boolean))}}#createProxy(t,e=""){const n={};n.get=(t,e)=>"--subscribe"===e?this:t[e],n.set=(t,e,n)=>{if("--subscribe"===e)return!0;t[e]=n;let r=t["--state-path"];if(r=r?`${r}.${e}`:e,r in this.subscriptions){const t=this.subscriptions[r]||[];for(const e in t){const{element:n,propertyName:r,subPropertyName:s,bindFunction:o,statementCallback:i}=t[e];if(n["--deleted"])this.unsubscribe(n);else{const t=o(n);"style"===r&&s?n.style[s]=f(s,t):"--if"===r?i(t):h(n,r,t)}}}return!0};const r=new Proxy(t,n);Object.defineProperty(r,"--state-path",{enumerable:!1,configurable:!1,writable:!1,value:e});for(const t in r)if(r[t]instanceof Object){const n=""===e?t:`${e}.${t}`;r[t]=this.#createProxy(r[t],n)}return r}}const E=new Function("try {return this===window;}catch(e){ return false;}")(),y=function t(e,n,r){const{mode:s}=t,o=function(t,e=""){return t&&"server"!==e?document:new l}(E,s),i=new b({target:e,states:n,contents:r,theGlobal:o});return"server"===s?i.getHtmlCode():i},v=function(t){return new g(t).getState()};y.mode=E?"browser":"server",y.state=v,y.createState=v;const C=y;var x=e.eK,w=e.ZP,N=e.Iv;export{x as createState,w as default,N as paintor};
//# sourceMappingURL=paintor.min.js.map